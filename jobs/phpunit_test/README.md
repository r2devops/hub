## Objective

Using this job you'll be able to launch PHPUnit tests.

## How to use it

1. Put a `phpunit.xml` (check [syntax](https://phpunit.readthedocs.io/en/10.5/configuration.html){:target="_blank"}) in the root of your php project. Edit `PHPUNIT_CONFIG_FILE` (see **Variables**) to change the default behavior.

2. Copy/paste job URL in `include` list of your `.gitlab-ci.yml` (see the **quick use**). You can specify [a fixed version](https://docs.r2devops.io/get-started/use-templates/#versioning) instead of `latest`.
3. If you need to customize the job (stage, variables, ...) ðŸ‘‰ check the [jobs
   customization](https://docs.r2devops.io/get-started/use-templates/#job-templates-customization)
4. Well done, your job is ready to work ! ðŸ˜€


## Variables

| Name | Description | Default |
| ---- | ----------- | ------- |
| `PHPUNIT_OUTPUT` <img width=100/> | Output file <img width=175/>| `report_phpunit.xml` <img width=100/>|
| `PHPUNIT_CONFIG_FILE` | Config file source in repository | `phpunit.xml` |
| `PHPUNIT_COLORS` | Use colors in output | `never` |
| `PHPUNIT_OPTIONS` | Custom user options for phpunit | ` ` |
| `PHPUNIT_MEMORY_LIMIT` | Memory available for PHPUnit (see [more](#php-memory-limit)) | `512M` |
| `PHPUNIT_VERSION` | PHPUnit version to install | `10.0.19` |
| `PROJECT_ROOT` | PHP Project location | `/` |
| `IMAGE_TAG` | The default tag for the docker image | `9.5.2`  |

!!! note
    All paths defined in variables are starting from the root of your repository.

## PHP Memory Limit

PHP default configuration limits the RAM used by a script with a limit of `128 MB`, this job elevates this limit to `512 MB`.
But, with this higher value, when you run a large amount of tests you may experience a **lack of memory** resulting in a job's failure.

The error generated by this problem may have the following format:
```yaml
Fatal error: Allowed memory size of x bytes exhausted (tried to allocate x bytes) in /path/to/project/root
```

## Artifacts

We use [Junit](https://junit.org/junit5/){:target="_blank"}'s XML report to display error report
directly in pipeline `Test` tab and in merge request widget.
The report defined in variable `PHPUNIT_OUTPUT` is also available directly in the artifacts.



## Author
This resource is an **[official job](https://docs.r2devops.io/get-started/faq/#use-a-template)** added in [**R2Devops repository**](https://gitlab.com/r2devops/hub) by [@Protocole](https://gitlab.com/Protocole)
